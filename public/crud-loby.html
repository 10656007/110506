<!DOCTYPE html>
<html>
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1">

    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Snippet' rel='stylesheet' type='text/css'>

    <link rel="icon" type="image/x-icon" href="../images/favicon.ico" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style.css">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500&display=swap" rel="stylesheet"> 

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500&display=swap" rel="stylesheet">

    <title>樂活網首頁</title>

  </head>

  <body>

    <div class="page-header" id="banner">
        <h1><a><img id="img" src="../images/logo1.png"><small id="small">樂活網</small></a></h1>
        <ul class="inline-block-nav">
            
            <input type="button" value="首頁" onclick="location.href='./crud-loby.html'"
            style="width:120px;height:40px;font-size:20px;">
            <input type="button" value="政府資訊" onclick="location.href='https://1966.gov.tw/LTC/cp-4495-48857-201.html'"
            style="width:120px;height:40px;font-size:20px;">
        </ul>
     </div>   

    <!-- <div class="fade-in title">
		<div id="title">
		<h1 class="centerTitle">專題報告110506</h1>
		</div>
	</div> -->

    <div class="fade-in">
		<div class="row">

            <div class="col-sm-5">
				<div class="leftModal"><i>
					<div>
					    <h3 class="leftModalText">雙北各地區養老院<br>
                            找到你喜歡或符合需求的<p>
                            配合政府資訊</h3>
                        <h2><a><img id="img" src="../images/view2.jpg"></a></h2>				
					</div></i>
				</div>
			</div>

        <div class="col-sm-1 middle-border"></div>

       
            <div class="form-box">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="form-group">
                            <div class="row">

                                <iframe name="hidden_iframe" style="display:none;"></iframe>
                                <form action="https://script.google.com/macros/s/AKfycbyW0NtULZ5lrfpxlHsw117siu4_uC18BsGf-J0bNUFcM7MMV_YbXMU1TIy4RS772KKv/exec" method="post" target="hidden_iframe">
                                <input type="hidden" name="method" value="1" />
                                姓名:<input type="text" id="input" name="name" class="form-control" placeholder="輸入姓名" ><br/>
                                連絡電話:<input type="text" id="input2" name="phone" class="form-control" placeholder="輸入連絡電話" ><br/>
                                年齡:<input type="text" id="input3" name="age" class="form-control" placeholder="輸入入住者年齡"><br/>
                                電子郵件:<input type="email" id="input4" name="email" class="form-control" placeholder="輸入聯絡人電子信箱" ><br/>
                               

                        
                                <input type="submit" class="btn6" value="新增使用者" /> 
                                
                                </form>


<!-- 
                                <div class="col-xs-6">
                                    <label class="mLabels">姓名</label>
                                    <input type="text" id="input" class="form-control" placeholder="輸入姓名" >
                                </div>
                                <div class="col-xs-6">
                                    <label class="mLabels">連絡電話</label>
                                    <input type="text" id="input2" class="form-control" placeholder="輸入連絡電話" >
                                </div>
                                <div class="col-xs-6">
                                    <label class="mLabels">年齡</label>
                                    <input type="text" id="input3" class="form-control" placeholder="輸入入住者年齡">  
                                </div>
                                <div class="col-xs-6">
                                    <label class="mLabels">電子信箱</label>
                                    <input type="email" id="input4" class="form-control" placeholder="輸入聯絡人電子信箱" >
                                </div> -->
                                
                            </div>
                        </div>

    <!-- Test Function -->
    <!-- <button type="button" id="btn">新增使用者</button> -->

    <ul id="ul"></ul>

    <button onclick="location.href='./crud-find1.html'" class="btn7">下一步</button>
    
   
    <form>
    <input type="checkbox" value="同意"/><b>&ensp;同意<br></b>
            歡迎您瀏覽使用樂活網，請您於填寫個人資料前，詳細閱讀《個人資料提供同意書》。
        若您點選「同意」，即表示您同意遵守《個人資料提供同意書》，
        您可依您的需求提供相關個資，包括姓名、通訊地址、電子郵件信箱、手機號碼或其他得以直接或間接識別您個人之資料等，樂活網會依法妥善保管。
    </form>
        
    <!-- <ul id="imgUl"></ul>
    <img id="shown_img" src="#" alt=""> -->

    <!-- Import the basic jquery lib. -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>  
    <!-- Import the associated firebase lib which the order is fixed. -->
    <script defer src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.0.1/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.0.1/firebase-storage.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.0.1/firebase-database.js"></script>
    <!-- Set the firebsae config and initialize it. -->
    <script defer src="init-firebase.js"></script>
    <!-- Test Code -->
    <script>
        // Variables
        var usr = {};

        $(document).ready(function() {
            var dbRef = firebase.database(); // firebase.database() is jquery language.
            //路徑
            var msgRef = dbRef.ref('/使用者資料/');
            
            // Database - CRUD
            // Push (C)
            $('#btn').on('click', function() {
                var msg = $('#input').val();
                var msg1 = $('#input2').val();
                var msg2 = $('#input3').val();
                var msg3 = $('#input4').val();

                if (msg == ""|| msg1 == ""|| msg2 == ""|| msg3 == "")
                {
                    $('#ul').html("請輸入資料");
                    return;
                }


                msgRef.push({
                    // 基本資訊
                    姓名: msg,
                    // 連絡電話
                    連絡電話: msg1,
                    // 出生日期
                    出生日期: msg2,
                    // 電子郵件
                    email: msg3
                });
            });
           
           

            
            // Read (R)
            msgRef.on('value', function(snapshot) {
            var val = snapshot.val();
            let list = '';
            
            $.each(val, function(i, item) {
                console.log('each: ', i, item.message);
                list = ``;
                    list += `<button text= "重新輸入" type="button" class="remove" data-key="${i}">重新輸入</button>`;
                });
                $('#ul').html(list);
            });
            
            // Update (U)
            $('#ul').on('click', '.update', function() {
                var key = $(this).data('key');
                var newMsg = $('#input_' + key).val();
                var postData = {
                    message: newMsg
                }
                var updates = {};
                updates['/messages/' + key] = postData;
                firebase.database().ref().update(updates);
            });
            
            // Delete (D)
            $('#ul').on('click', '.remove', function(){
                var key = $(this).data('key');
                msgRef.child(key).remove();
            });
            
            // Storage - CRUD
            var strgRef = firebase.storage().ref('/uploads/');
            
            var metadata =  {
                contentType: 'image/jepg'
            }
            
            // Push (C) - File & Image
            $('#uplaodFile').on('click', function() {
                var file = $('#uplaodsFile').prop('files')[0];
                var imgRef = strgRef.child(file.name);
                
                // console.log(file);
                
                imgRef.put(file).then(function(snapshot) {
                    console.log('Uploaded a blob or file!');
                });
                
            });

            // Push (C) - Unit8Array
            $('#uploadutf8').on('click', function() {
                var u8aRef = firebase.storage().ref('Unit8Array').child('test');
                // Uint8Array
                var bytes = new Uint8Array([0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x77, 0x6f, 0x72, 0x6c, 0x64, 0x21]);
                u8aRef.put(bytes).then(function(snapshot) {
                    console.log('Uploaded an array!');
                });
            });

            // Push (C) - String
            $('#uplaodString').on('click', function() {
                var strRef = firebase.storage().ref('String').child('00001');

                var msg = '5b6p5Y+344GX44G+44GX44Gf77yB44GK44KB44Gn44Go44GG77yB';
                strRef.putString(msg, 'base64').then(function(snapshot) {
                    console.log('Uploaded a base64 string!');
                });
            });
            

            // Read (R)


            // Download (R)
            $('#show').on('click', function() {
                var imgName = 'USPS.jpg'
                var pathRef = strgRef.child(imgName);
                // var gsRef = firebase.storage().refFromURL('gs://bucket/uploads/' + imgName);
                // var httpRef = firebase.storage().refFromURL('https://firebasestorage.googleapis.com/b/bucket/o/uploads/' + imgName);

                pathRef.getDownloadURL().then(function(url) {
                    console.log(url);

                    // This can be downloaded directly:
                    // var xhr = new XMLHttpRequest();
                    // xhr.responseType = 'blob';
                    // xhr.onload = function(event) {
                    //     var blob = xhr.response;
                    // };
                    // xhr.open('GET', url);
                    // xhr.send();

                    // $('#shown_img').attr('src', url);
                    var img = document.getElementById('shown_img');
                    img.src = url;
                }).catch(function(e) {
                    switch(e.code) {
                        case 'storage/object-not-found':
                        // File doesn't exist
                        break;

                        case 'storage/unauthorized':
                        // User doesn't have permission to access the object
                        break;

                        case 'storage/canceled':
                        // User canceled the upload
                        break;

                        case 'storage/unknown':
                        // Unknown error occurred, inspect the server response
                        break;
                    }
                });

            });
            
            // Delete (D)
            $('#delete').on('click', function() {
                var delImgRef = strgRef.child('Cover.png');

                delImgRef.delete().then(function() {
                    console.log('Delete Image.');
                }).catch(function(e) {
                    console.log(e);
                });
            });
            
            // Cookie
            $('#next').on('click', function() {
                document.cookie = "username=RobbenHsieh";
                window.location.replace('html/receieve.html');
                console.log("1st Page: " + document.cookie);
            });

        });
    </script>
  </body>
</html>
